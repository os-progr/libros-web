<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LibrosWeb - Comparte y Descubre Libros</title>
    <meta name="description"
        content="Plataforma para compartir y descubrir libros. Publica tus obras y explora la biblioteca de la comunidad.">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Outfit:wght@700;800&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="login-styles.css">
    <link rel="icon" type="image/jpeg" href="logo.jpg">
</head>

<body class="no-select">
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">üìö</span>
                    <span>LibrosWeb</span>
                </div>

                <div class="search-bar">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" id="searchInput" placeholder="Buscar libros, autores..."
                        autocomplete="off">
                </div>

                <div class="nav-actions">
                    <!-- Theme Toggle -->
                    <button class="theme-toggle" id="themeToggle" title="Cambiar tema">
                        <span id="themeIcon">üåô</span>
                    </button>

                    <!-- Developer Mode Icon (Only for admin) -->
                    <button class="developer-toggle hidden" id="developerToggle" title="Modo Desarrollador">
                        <span class="developer-icon">‚öôÔ∏è</span>
                    </button>

                    <!-- Authenticated user actions -->
                    <div id="authenticatedActions" class="hidden">
                        <div class="notifications-wrapper">
                            <button class="notification-btn" id="notificationBtn">
                                üîî
                                <span class="notification-badge hidden" id="notificationBadge">0</span>
                            </button>
                            <div class="notifications-dropdown hidden" id="notificationsDropdown">
                                <div class="notifications-header">
                                    <h3>Notificaciones</h3>
                                    <button class="mark-read-btn" id="markAllReadBtn">Marcar todas le√≠das</button>
                                </div>
                                <div class="notifications-list" id="notificationsList">
                                    <div class="empty-notifications">No tienes notificaciones</div>
                                </div>
                            </div>
                        </div>

                        <div class="user-profile">
                            <img id="userPicture" src="" alt="User" class="user-avatar">
                            <span id="userName"></span>
                        </div>
                        <button class="btn btn-primary" id="uploadBtn">
                            <span>üì§</span>
                            <span>Publicar Libro</span>
                        </button>
                        <button class="btn btn-secondary" id="logoutBtn">
                            <span>üö™</span>
                            <span>Salir</span>
                        </button>
                    </div>

                    <!-- Unauthenticated user actions -->
                    <div id="unauthenticatedActions" class="hidden">
                        <a href="/auth/google" class="btn btn-primary google-btn">
                            <span>üîê</span>
                            <span>Iniciar sesi√≥n con Google</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Login / Welcome Screen -->
            <section id="welcomeScreen" class="login-background hidden">
                <div class="login-card">
                    <!-- Icon -->
                    <div class="login-icon-container">
                        üó≥Ô∏è
                    </div>

                    <!-- Inputs (Visual Only / Google Trigger) -->
                    <div style="margin-top: 2rem;"></div>

                    <div class="login-input-group">
                        <span class="login-input-icon">üë§</span>
                        <input type="text" class="login-input" placeholder="Usuario" disabled
                            style="cursor: not-allowed; background: #f0f0f0;">
                    </div>

                    <div class="login-input-group">
                        <span class="login-input-icon">üîí</span>
                        <input type="password" class="login-input" placeholder="Contrase√±a" disabled
                            style="cursor: not-allowed; background: #f0f0f0;">
                    </div>

                    <!-- Buttons -->
                    <a href="/auth/google" class="btn-login-custom">
                        LOGIN CON GOOGLE
                    </a>

                    <div class="login-divider"></div>

                    <button class="btn-register-custom"
                        onclick="alert('El registro es autom√°tico al iniciar sesi√≥n con Google.')">
                        REGISTRARSE
                    </button>
                    <p style="margin-top: 10px; font-size: 0.8rem; color: #888;">Acceso exclusivo con cuenta Google</p>
                </div>
            </section>

            <!-- Books Section (for authenticated users) -->
            <section id="booksSection" class="hidden">
                <div class="hero">
                    <h1 class="hero-title">Mis Libros</h1>
                    <p class="hero-subtitle">Gestiona tu biblioteca personal</p>
                </div>

                <div class="books-grid" id="booksGrid">
                    <!-- Books will be dynamically inserted here -->
                </div>

                <!-- Empty State -->
                <div class="empty-state hidden" id="emptyState">
                    <div class="empty-icon">üìñ</div>
                    <h2 class="empty-title">No hay libros a√∫n</h2>
                    <p class="empty-text">S√© el primero en publicar un libro</p>
                    <button class="btn btn-primary" onclick="document.getElementById('uploadBtn').click()">
                        <span>üì§</span>
                        <span>Publicar el Primer Libro</span>
                    </button>
                </div>
            </section>
        </div>
    </main>

    <!-- Upload Modal -->
    <div class="modal-overlay" id="uploadModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Publicar Nuevo Libro</h2>
                <button class="modal-close" id="closeUploadModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="uploadForm">
                    <div class="form-group">
                        <label class="form-label" for="bookTitle">T√≠tulo del Libro *</label>
                        <input type="text" class="form-input" id="bookTitle" required placeholder="Ej: El Principito">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="bookAuthor">Autor *</label>
                        <input type="text" class="form-input" id="bookAuthor" required
                            placeholder="Ej: Antoine de Saint-Exup√©ry">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="bookDescription">Descripci√≥n</label>
                        <textarea class="form-textarea" id="bookDescription"
                            placeholder="Breve descripci√≥n del libro..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Archivo PDF (Obligatorio) *</label>
                        <div class="file-input-wrapper">
                            <label for="bookFile" class="file-input-label">
                                <span>üìÑ</span>
                                <span>Seleccionar archivo PDF</span>
                            </label>
                            <input type="file" class="file-input" id="bookFile" name="pdf" accept=".pdf" required>
                        </div>
                        <div class="file-name" id="fileName"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Archivo Word (Opcional)</label>
                        <div class="file-input-wrapper">
                            <label for="bookDocx" class="file-input-label">
                                <span>üìù</span>
                                <span>Seleccionar archivo Word</span>
                            </label>
                            <input type="file" class="file-input" id="bookDocx" name="docx" accept=".doc,.docx">
                        </div>
                        <div class="file-name" id="docxFileName"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Imagen de Portada (Opcional)</label>
                        <div class="file-input-wrapper">
                            <label for="bookCover" class="file-input-label">
                                <span>üñºÔ∏è</span>
                                <span>Seleccionar imagen</span>
                            </label>
                            <input type="file" class="file-input" id="bookCover" name="cover" accept="image/*">
                        </div>
                        <div class="file-name" id="coverFileName"></div>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <span>‚ú®</span>
                            <span>Publicar Libro</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Book Viewer Modal -->
    <div class="modal-overlay" id="viewerModal">
        <div class="modal viewer-modal">
            <div class="modal-header">
                <h2 class="modal-title" id="viewerTitle">T√≠tulo del Libro</h2>
                <button class="modal-close" id="closeViewerModal">&times;</button>
            </div>
            <div class="modal-body viewer-content">
                <iframe class="pdf-viewer" id="pdfViewer"></iframe>
            </div>
            <div class="viewer-actions">
                <button class="btn btn-secondary" id="closeViewerBtn">
                    <span>‚ùå</span>
                    <span>Cerrar</span>
                </button>
                <button class="btn btn-primary" id="downloadPdfBtn">
                    <span>‚¨áÔ∏è</span>
                    <span>Descargar PDF</span>
                </button>
                <button class="btn btn-primary hidden" id="downloadDocxBtn">
                    <span>üìù</span>
                    <span>Descargar Word</span>
                </button>
            </div>
        </div>
    </div>
    <!-- Admin Panel Modal -->
    <div class="modal-overlay" id="adminPanel">
        <div class="modal admin-panel-modal">
            <div class="modal-header">
                <h2 class="modal-title">‚öôÔ∏è Panel de Administraci√≥n</h2>
                <button class="modal-close" id="closeAdminPanel">&times;</button>
            </div>
            <div class="modal-body">
                <div class="admin-section">
                    <h3 class="admin-section-title">üìä Estad√≠sticas del Sistema</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-value" id="statUsers">-</div>
                            <div class="stat-label">Usuarios</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìö</div>
                            <div class="stat-value" id="statBooks">-</div>
                            <div class="stat-label">Libros</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚¨áÔ∏è</div>
                            <div class="stat-value" id="statDownloadsToday">-</div>
                            <div class="stat-label">Descargas Hoy</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-value" id="statTotalDownloads">-</div>
                            <div class="stat-label">Total Descargas</div>
                        </div>
                    </div>
                    <div class="popular-book" id="popularBook">
                        <div class="popular-book-icon">üî•</div>
                        <div class="popular-book-info">
                            <div class="popular-book-title">Cargando...</div>
                            <div class="popular-book-subtitle">Libro m√°s popular</div>
                        </div>
                    </div>
                </div>
                <div class="admin-section">
                    <h3 class="admin-section-title">‚ö° Acciones R√°pidas</h3>
                    <div class="admin-actions">
                        <button class="btn btn-secondary" id="btnRefreshStats"><span>üîÑ</span><span>Actualizar
                                Datos</span></button>
                        <button class="btn btn-secondary" id="btnClearCache"><span>üóëÔ∏è</span><span>Limpiar
                                Cach√©</span></button>
                        <button class="btn btn-secondary" id="btnViewUsers"><span>üë•</span><span>Ver
                                Usuarios</span></button>
                        <button class="btn btn-secondary" id="btnViewAllBooks"><span>üìö</span><span>Gestionar
                                Libros</span></button>
                    </div>
                </div>
                <div class="admin-section">
                    <h3 class="admin-section-title">‚ÑπÔ∏è Informaci√≥n del Sistema</h3>
                    <div class="system-info">
                        <div class="info-row"><span class="info-label">Versi√≥n:</span><span
                                class="info-value">v10.4</span></div>
                        <div class="info-row"><span class="info-label">Libros Hoy:</span><span class="info-value"
                                id="statBooksToday">-</span></div>
                        <div class="info-row"><span class="info-label">Reportes Pendientes:</span><span
                                class="info-value" id="statPendingReports">-</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Users Management Modal -->
    <div class="modal-overlay" id="usersModal">
        <div class="modal users-modal">
            <th>Descargas</th>
            <th>Registro</th>
            <th>Acciones</th>
            </tr>
            </thead>
            <tbody id="usersTableBody">
                <!-- Users will be loaded here -->
            </tbody>
            </table>
        </div>
    </div>
    </div>
    </div>
    <!-- Books Management Modal -->
    <div class="modal-overlay" id="booksModal">
        <div class="modal books-modal">
            <div class="modal-header">
                <h2 class="modal-title">üìö Gesti√≥n de Libros</h2>
                <button class="modal-close" id="closeBooksModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="books-table-container">
                    <table class="users-table"> <!-- Reusing users-table class for consistent styling -->
                        <thead>
                            <tr>
                                <th>T√≠tulo</th>
                                <th>Autor</th>
                                <th>Subido por</th>
                                <th>Descargas</th>
                                <th>Reportes</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="booksTableBody">
                            <!-- Books will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Book Modal -->
    <div class="modal-overlay" id="editBookModal">
        <div class="modal edit-book-modal">
            <div class="modal-header">
                <h2 class="modal-title">‚úèÔ∏è Editar Libro</h2>
                <button class="modal-close" id="closeEditBookModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editBookForm" class="edit-book-form">
                    <input type="hidden" id="editBookId">
                    <div class="form-group">
                        <label for="editBookTitle">T√≠tulo</label>
                        <input type="text" id="editBookTitle" required class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="editBookAuthor">Autor</label>
                        <input type="text" id="editBookAuthor" required class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="editBookDescription">Descripci√≥n</label>
                        <textarea id="editBookDescription" rows="4" class="form-input"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelEditBook">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>




    <!-- Admin Feedback Modal -->
    <div class="modal-overlay" id="feedbackModal">
        <div class="modal feedback-modal">
            <div class="modal-header">
                <h2 class="modal-title">üì¢ Enviar Recomendaci√≥n</h2>
                <button class="modal-close" id="closeFeedbackModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="feedbackForm">
                    <input type="hidden" id="feedbackBookId">
                    <div class="form-group">
                        <label class="form-label">Libro:</label>
                        <div id="feedbackBookTitle" class="book-preview-title"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="feedbackMessage">Mensaje / Recomendaci√≥n *</label>
                        <textarea class="form-textarea" id="feedbackMessage" required rows="5"
                            placeholder="Ej: Te recomendamos mejorar la calidad de la portada..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="feedbackType">Tipo</label>
                        <select class="form-input" id="feedbackType">
                            <option value="info">‚ÑπÔ∏è Informaci√≥n / Consejo</option>
                            <option value="warning">‚ö†Ô∏è Advertencia</option>
                            <option value="success">‚úÖ Felicitaci√≥n</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelFeedback">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Enviar Feedback</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin User Notification Modal -->
    <div class="modal-overlay" id="userNotifyModal">
        <div class="modal feedback-modal">
            <div class="modal-header">
                <h2 class="modal-title">üîî Notificar Usuario</h2>
                <button class="modal-close" id="closeUserNotifyModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userNotifyForm">
                    <input type="hidden" id="userNotifyUserId">
                    <div class="form-group">
                        <label class="form-label">Usuario Destino:</label>
                        <div id="userNotifyUserName" class="book-preview-title"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="userNotifyTitle">T√≠tulo</label>
                        <input type="text" class="form-input" id="userNotifyTitle" placeholder="Ej: Aviso importante">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="userNotifyMessage">Mensaje *</label>
                        <textarea class="form-textarea" id="userNotifyMessage" required rows="5"
                            placeholder="Escribe tu mensaje aqu√≠..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="userNotifyType">Tipo</label>
                        <select class="form-input" id="userNotifyType">
                            <option value="info">‚ÑπÔ∏è Informaci√≥n</option>
                            <option value="warning">‚ö†Ô∏è Advertencia</option>
                            <option value="success">‚úÖ √âxito</option>
                            <option value="error">‚ùå Error/Alerta</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelUserNotify">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Enviar Notificaci√≥n</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div class="modal-overlay" id="reviewModal">
        <div class="modal review-modal">
            <div class="modal-header">
                <h2 class="modal-title">‚≠ê Rese√±as</h2>
                <button class="modal-close" id="closeReviewModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="book-summary-mini" id="reviewBookSummary"></div>

                <div class="reviews-container">
                    <div class="existing-reviews" id="reviewsList">
                        <!-- Reviews will be loaded here -->
                    </div>
                </div>

                <div class="write-review-section" id="writeReviewSection">
                    <h3>Escribir Rese√±a</h3>
                    <form id="reviewForm">
                        <input type="hidden" id="reviewBookId">
                        <div class="form-group">
                            <label class="form-label">Calificaci√≥n</label>
                            <div class="star-rating-input" id="starRatingInput">
                                <span data-value="1">‚òÖ</span>
                                <span data-value="2">‚òÖ</span>
                                <span data-value="3">‚òÖ</span>
                                <span data-value="4">‚òÖ</span>
                                <span data-value="5">‚òÖ</span>
                            </div>
                            <input type="hidden" id="reviewRating" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tu Opini√≥n</label>
                            <textarea class="form-textarea" id="reviewText" rows="3"
                                placeholder="¬øQu√© te pareci√≥ este libro?"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Publicar Rese√±a</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal profile-modal">
            <div class="modal-header">
                <h2 class="modal-title">üë§ Perfil de Usuario</h2>
                <button class="modal-close" id="closeProfileModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-header">
                    <img src="" alt="Profile" id="profileImage" class="profile-avatar-large">
                    <div class="profile-info">
                        <h2 id="profileName">Usuario</h2>
                        <p id="profileBio" class="profile-bio">Sin biograf√≠a</p>
                        <div class="profile-meta">
                            <span id="profileLocation">üìç Ubicaci√≥n desconocida</span>
                            <a href="#" id="profileWebsite" target="_blank">üåê Sitio Web</a>
                        </div>
                    </div>
                </div>

                <div class="profile-stats">
                    <div class="stat-box">
                        <span class="stat-number" id="profileTotalBooks">0</span>
                        <span class="stat-label">Libros</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number" id="profileTotalDownloads">0</span>
                        <span class="stat-label">Descargas</span>
                    </div>
                </div>

                <div id="profileEditSection" class="hidden">
                    <button class="btn btn-secondary" id="btnEditProfile">‚úèÔ∏è Editar Perfil</button>
                </div>

                <h3>üìö Libros Publicados</h3>
                <div class="profile-books-grid" id="profileBooksGrid">
                    <!-- User books will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal-overlay" id="editProfileModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">‚úèÔ∏è Editar Perfil</h2>
                <button class="modal-close" id="closeEditProfileModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editProfileForm">
                    <div class="form-group">
                        <label class="form-label">Biograf√≠a</label>
                        <textarea class="form-textarea" id="editProfileBio" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sitio Web</label>
                        <input type="url" class="form-input" id="editProfileWebsite">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ubicaci√≥n</label>
                        <input type="text" class="form-input" id="editProfileLocation">
                    </div>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div class="modal-overlay" id="logoutModal">
        <div class="modal confirmation-modal">
            <div class="modal-header">
                <h2 class="modal-title">üö™ Cerrar Sesi√≥n</h2>
                <button class="modal-close" id="closeLogoutModal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="confirmation-text">¬øEst√°s seguro de que deseas salir de tu cuenta?</p>
                <div class="form-actions">
                    <button class="btn btn-secondary" id="cancelLogout">Cancelar</button>
                    <button class="btn btn-danger" id="confirmLogout">Cerrar Sesi√≥n</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="app.js"></script>
</body>

</html>